# 계획 및 백로그

## Epic & 마일스톤

### Epic 1: 핵심 인프라

#### M1.1: 프로젝트 스캐폴딩 & 설정 (Small)
- pnpm으로 TypeScript 프로젝트 초기화
- strict 모드로 `tsconfig.json` 설정
- 폴더 구조 설정 (`src/`, `tests/`, `config/`)
- ESLint, Prettier 설정

#### M1.2: 설정 로더 & 검증기 (Medium)
- `yaml` 패키지로 YAML 파싱
- Zod 스키마 검증
- 설정 타입 정의
- 기본 설정 생성

#### M1.3: Logger & Tracer (Medium)
- JSONL 형식 로거
- `AsyncLocalStorage`를 사용한 `trace_id` 전파
- 로그 레벨 (debug, info, warn, error)
- 파일 및 콘솔 출력

### Epic 2: L1 Orchestrator

#### M2.1: CLI 진입점 (Small)
- `commander` 인자 파서
- 서브커맨드: `run`, `agent`, `eval`
- 버전 및 도움말 출력
- 전역 옵션 처리

#### M2.2: Run 디렉토리 관리자 (Small)
- `./runs/{timestamp}/` 디렉토리 생성
- 아티팩트 저장 및 정리
- 파일 시스템 헬퍼
- 경로 검증

#### M2.3: 정책 엔진 (Medium)
- 화이트리스트 검증
- FS/네트워크 샌드박스 체크
- 리소스 제한 적용
- 보안 정책 적용

#### M2.4: 집계 및 보고서 생성 (Medium)
- Markdown 템플릿 렌더링
- 메트릭 요약 (성공률, 평균 지속시간)
- 아티팩트 목록
- 에러 집계

### Epic 3: L2 Coordinator

#### M3.1: Claude Code 어댑터 (Large)
- 프롬프트 템플릿 엔진
- LLM 호출 및 파싱 (JSON 추출)
- Few-shot 예제 관리
- 에러 처리 및 재시도

#### M3.2: DAG 생성기 (Medium)
- 의존성 위상 정렬
- 순환 감지
- 태스크 순서 알고리즘
- 그래프 검증

#### M3.3: 태스크 메시지 빌더 (Small)
- L3 JSON 메시지 생성
- `task_id` / `parent_id` 할당
- 제약 조건 전파

### Epic 4: L3 Worker

#### M4.1: 도구 실행기 (Medium)
- `child_process` 서브프로세스 래퍼
- stdout/stderr 스트리밍
- 종료 코드 처리
- 환경 변수 주입

#### M4.2: 재시도 로직 (Small)
- 지수 백오프 구현
- 상태 추적 (`retries` 카운터)
- 최대 재시도 적용
- 실패 분류

#### M4.3: 아티팩트 수집기 (Small)
- `./runs/{id}/artifacts/`로 출력 파일 복사
- 체크섬 계산 (SHA256)
- 아티팩트 메타데이터 생성

### Epic 5: 테스트 및 평가

#### M5.1: 단위 테스트 (Medium)
- 각 모듈 테스트 (config, logger, L1/L2/L3)
- 최소 80% 코드 커버리지
- LLM 응답 모킹
- 엣지 케이스 테스트

#### M5.2: 통합 테스트 (Large)
- 종단 간 시나리오 (golden fixtures)
- `--plan-only` / `--dry-run` 테스트 케이스
- 멀티태스크 워크플로우
- 장애 복구 시나리오

#### M5.3: 평가 프레임워크 (Medium)
- `orchestra eval` 명령 구현
- 벤치마크 시나리오 (3개 이상)
- 성능 메트릭 수집
- 보고서 생성

### Epic 6: 문서화 및 배포

#### M6.1: README & 사용 가이드 (Small)
- 빠른 시작 가이드
- 설치 지침
- 기본 예제
- 설정 참조

#### M6.2: 예제 프로젝트 (Small)
- 샘플 시나리오 파일
- 일반적인 워크플로우 템플릿
- 모범 사례 문서

#### M6.3: CI/CD 파이프라인 (Medium, 선택 사항)
- GitHub Actions 설정
- 자동 테스트
- 릴리스 자동화

## 우선순위 (MoSCoW)

| 카테고리 | 항목 |
|----------|-------|
| **Must Have** | M1.1, M1.2, M1.3, M2.1, M2.2, M3.1, M3.2, M4.1, M5.1 |
| **Should Have** | M2.3, M2.4, M3.3, M4.2, M4.3, M5.2 |
| **Could Have** | M5.3, M6.1, M6.2 |
| **Won't Have (MVP)** | M6.3, 분산 스케줄러, 원격 에이전트, Web UI |

## 크리티컬 패스

1. **Day 1-2**: M1.1, M1.2 (스캐폴딩 + 설정)
2. **Day 3-4**: M1.3, M2.1, M2.2 (로깅 + CLI + Run 관리)
3. **Day 5-7**: M3.1, M3.2 (L2 LLM 어댑터 + DAG)
4. **Day 8-9**: M4.1, M4.2 (L3 실행기 + 재시도)
5. **Day 10**: M2.3, M2.4 (정책 + 보고)
6. **Day 11-12**: M5.1, M5.2 (테스트)
7. **Day 13-14**: 통합, 디버깅, M6.1 (README)

## 2주 MVP 계획

| Day | 집중 영역 | 산출물 |
|-----|-------------|--------------|
| **1-2** | 프로젝트 초기화, 설정 로더, 폴더 구조 | 빌드 및 실행 스캐폴드 작동 |
| **3-4** | Logger, CLI 파서, run 디렉토리 관리 | `orchestra run --help` 기능 작동 |
| **5-7** | L2 Coordinator (LLM 어댑터, DAG 생성) | `--plan-only` 모드 작동 |
| **8-9** | L3 Worker (도구 실행, 재시도) | 더미 태스크 종단 간 실행 |
| **10** | L1 정책 엔진, 보고서 생성 | Markdown 보고서 출력 |
| **11-12** | 테스트 작성 (단위 + 통합) | CI 로컬 통과 |
| **13-14** | 디버깅, README, 예제 시나리오 | 릴리스 가능한 MVP |

## 작업 분해 구조 (WBS)

### Phase 1: 기반 (Days 1-4)
```
1. 설정
   1.1 pnpm workspace 초기화
   1.2 TypeScript 설정
   1.3 테스트 프레임워크 설정 (Vitest)
   1.4 디렉토리 구조 생성

2. 설정 시스템
   2.1 Zod 스키마 정의
   2.2 YAML 로더 구현
   2.3 기본 설정 생성
   2.4 검증 로직 추가

3. 로깅 인프라
   3.1 JSONL 로거 구현
   3.2 Trace ID 컨텍스트
   3.3 파일/콘솔 출력
   3.4 로그 로테이션 (선택 사항)
```

### Phase 2: 핵심 에이전트 (Days 5-10)
```
4. L1 Orchestrator
   4.1 CLI 진입점
   4.2 Run 디렉토리 관리자
   4.3 정책 엔진
   4.4 보고서 생성기

5. L2 Coordinator
   5.1 Claude Code 클라이언트
   5.2 프롬프트 템플릿
   5.3 DAG 빌더
   5.4 태스크 메시지 팩토리

6. L3 Worker
   6.1 서브프로세스 실행기
   6.2 재시도 로직
   6.3 아티팩트 수집기
   6.4 메트릭 추적기
```

### Phase 3: 품질 및 마무리 (Days 11-14)
```
7. 테스트
   7.1 단위 테스트 (80%+ 커버리지)
   7.2 통합 테스트
   7.3 Golden 테스트 픽스처
   7.4 성능 벤치마크

8. 문서화
   8.1 README
   8.2 API 문서
   8.3 예제 시나리오
   8.4 문제 해결 가이드
```

## 리소스 할당 (단독 개발자)

- **개발**: 70% (Days 1-10, Days 13-14)
- **테스트**: 20% (Days 11-12)
- **문서화**: 10% (지속적, Day 13-14에 완료)

## 의존성 및 블로커

### 외부 의존성
- Claude Code API 가용성
- TypeScript/Node.js 생태계 안정성
- pnpm 패키지 해결

### 내부 의존성
- M3.1 (LLM 어댑터)이 M3.2 (DAG 생성기)를 블록
- M2.2 (Run 관리자)가 M2.4 (보고)를 블록
- M4.1 (실행기)이 M4.2 (재시도) 및 M4.3 (아티팩트)를 블록

### 리스크 완화
- 개발/테스트용 Claude Code 응답 모킹
- 누락/유효하지 않은 설정에 대한 폴백 설정 구현
- 격리된 테스트 환경 생성

## 성공 메트릭

### MVP 수락 기준
- [ ] 모든 Must Have 기능 구현
- [ ] 80%+ 단위 테스트 커버리지
- [ ] 3개 이상 통합 테스트 통과
- [ ] `--plan-only` 및 `--dry-run` 모드 기능 작동
- [ ] 빠른 시작 가이드가 포함된 README
- [ ] 예제 시나리오 성공적으로 실행
